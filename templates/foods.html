<!DOCTYPE html>
<html lang="id">

<head>
<meta charset="UTF-8">
<title>Catatan Makan</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body style="background:#f4f6f9;">

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-dark">
<div class="container">
<a class="navbar-brand">üçè Diet Planner</a>

<div>
<a href="{{ url_for('dashboard') }}" class="btn btn-light btn-sm">Dashboard</a>
<a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">Logout</a>
</div>

</div>
</nav>

<div class="container mt-4">

<h4>Catatan Makan - {{ user.name }}</h4>

<!-- ================= SISA KALORI ================= -->
<div class="alert alert-success">
Sisa Kalori Hari Ini : <b>{{ sisa_kalori }} kcal</b>
</div>

<!-- ================= FORM TAMBAH MAKAN ================= -->
<div class="card p-3 mb-4">
<h5>Tambah Makanan</h5>

<form id="mealForm">

<div class="row">

<div class="col-md-4">
<select name="id_makanan" class="form-control" required>
<option value="">-- Pilih Makanan --</option>
{% for food in foods_all %}
<option value="{{ food.id_makanan }}">
{{ food.nama_makanan }} ({{ food.kalori }} kcal)
</option>
{% endfor %}
</select>
</div>

<div class="col-md-3">
<select name="waktu_makan" class="form-control">
<option value="Pagi">Pagi</option>
<option value="Siang">Siang</option>
<option value="Malam">Malam</option>
</select>
</div>

<div class="col-md-3">
<input type="number" name="jumlah_porsi" class="form-control" placeholder="Porsi" required>
</div>

<div class="col-md-2">
<button class="btn btn-success w-100">Tambah</button>
</div>

</div>
</form>
</div>

<!-- ================= REKOMENDASI ================= -->
<div class="card p-3 mb-4">

<h5>Rekomendasi Makanan</h5>

<div class="row">

{% for food in foods_recommend %}
<div class="col-md-3 mb-3">

<div class="card p-2">
<h6>{{ food.nama_makanan }}</h6>
<p>Kalori : {{ food.kalori }}</p>
<p>Protein : {{ food.protein }} g</p>
</div>

</div>
{% endfor %}

</div>
</div>

<!-- ================= HISTORY ================= -->
<div class="card p-3">

<h5>Makanan Hari Ini</h5>

<table class="table">
<tr>
<th>Nama</th>
<th>Porsi</th>
<th>Waktu</th>
</tr>

{% for h in history %}
<tr>
<td>{{ h.nama_makanan }}</td>
<td>{{ h.jumlah_porsi }}</td>
<td>{{ h.waktu_makan }}</td>
</tr>
{% endfor %}

</table>

</div>

</div>

<!-- AJAX SUBMIT -->
<script>
document.getElementById("mealForm").addEventListener("submit", function(e){
e.preventDefault();

let data = Object.fromEntries(new FormData(this));

fetch("/add_meal",{
method:"POST",
headers:{ "Content-Type":"application/json" },
body: JSON.stringify(data)
})
.then(()=> location.reload());
});
</script>

</body>
</html>
